{% extends "base.html" %}
{% load static from staticfiles %}
{% block title %}主页{% endblock %}
{% block head %}
    <script type="text/javascript">
        var district_ids = new Array();
        {% for district_id in district_ids %}
            district_ids.push({{ district_id }});
        {% endfor %}
    </script>
{% endblock %}
{% block content %}
    <div class="container">

    </div>
	<div id="allmap">

    </div>
{% endblock %}
{% block endscript %}
<script type="text/javascript">

	// 百度地图API功能
	var map = new BMap.Map("allmap");
	map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);     // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom();                        //启用滚轮放大缩小
    var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT});// 左上角，添加比例尺
	var top_left_navigation = new BMap.NavigationControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT});  //左上角，添加默认缩放平移控件
    map.addControl(top_left_control);
    map.addControl(top_left_navigation);
    map.enableKeyboard();

    function redraw_polygons()
    {
        map.clearOverlays();

        for ( var region_id in data ){
        var points = [];  // 添加海量点数据

        for (var i = 0; i < data[region_id].length; i++) {
                points.push(new BMap.Point(data[region_id][i][0], data[region_id][i][1]));
        }
        var geo_center_point = new BMap.Point(geocenter[region_id][0],geocenter[region_id][1]);
        var marker = new BMap.Marker(geo_center_point);  // 创建标注
	    map.addOverlay(marker);              // 将标注添加到地图中

        var label = new BMap.Label(get_region_label(region_id),{position :geo_center_point,offset   : new BMap.Size(20, -10)});
        label.setStyle({
			 color : "white",
			 fontSize : "12px",
             border :"0",
             backgroundColor :"0.0"
		 });
        marker.setLabel(label);
        var polygon = new BMap.Polygon(points, { strokeColor:"#FFFFFF",fillColor:gradient[get_region_color(region_id)], strokeWeight:1, strokeOpacity:0.5});  // 初始化PointCollection
        map.addOverlay(polygon);
    }
    }

</script>
{% endblock %}
